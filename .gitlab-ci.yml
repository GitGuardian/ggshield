image: gitguardian/ci:latest
stages:
  - test
  - deploy

test:
  stage: test
  before_script:
    - pipenv install --dev
  script:
    - pipenv run pytest --disable-pytest-warnings -vvv


lint:
  stage: test
  before_script:
    - pipenv install --dev
  script:
    - pipenv run flake8
    - pipenv run black --config black.toml --check **/*.py


deploy:
  script:
    - python setup.py sdist bdist_wheel
    - python -m twine upload --repository-url https://${PYPI_USERNAME}:${PYPI_PASSWORD}@${PYPI_HOST} dist/*.gz
  only:
    refs:
      - dev
